___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "amoCRM CRM Plugin",
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Используйте шаблон amoCRM, чтобы добавить CRM Plugin на свой сайт. Посетители смогут связаться с вашей компанией, используя предпочитаемый ими способ, а вы сможете управлять всеми беседами в amoCRM.",
  "categories": [
    "CHAT",
    "LEAD_GENERATION",
    "SALES"
  ],
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "id",
    "displayName": "Ключ установки кнопки",
    "simpleValueType": true,
    "help": "1. Зайдите в свой “аккаунт amoCRM” \u003e “Сделки” \u003e “Настроить”. 2. В левой части экрана, под заголовком “Источник сделок”, нажмите кнопку “+Добавить” и выберите \"CRM Plugin\". 3. На странице настроек источника \"CRM Plugin\" перейдите на вкладку \"Установка\". 4. Откройте раздел \"Установите самостоятельно с помощью Google Tag Manager\" и скопируйте ключ установки кнопки в поле снизу."
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// require relevant API
const setInWindow = require('setInWindow');
const log = require('logToConsole');
const injectScript = require('injectScript');

// capture values of template fields
const button_id = data.id;

const stringParser = (str) => {
  const parts = str ? str.split(',') : '';

  if (parts.length === 3) {
    return {
      'id': parts[0],
      'hash': parts[1],
      'locale': parts[2],
      'inline': false,
      'setMeta':function(p){log(p);}
    };
  } else {
    // Возвращаем пустой объект, если значений недостаточно
    return {};
  }
};
//button settings Obj
const amo_social_button = stringParser(button_id);

setInWindow('amo_social_button', amo_social_button);
setInWindow('amoSocialButton', function(){(amo_social_button.q=amo_social_button.q||[]).push(arguments);});

// Call data.gtmOnSuccess when the tag is finished.
injectScript('https://gso.amocrm.ru/js/button.js', data.gtmOnSuccess);


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "all"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://gso.amocrm.ru/js/button.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "amo_social_button"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "amoSocialButton"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "crmPlugin"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 24.01.2024, 10:50:25


